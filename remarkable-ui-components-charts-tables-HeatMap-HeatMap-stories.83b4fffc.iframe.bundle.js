"use strict";(self.webpackChunk_embeddable_com_remarkable_ui=self.webpackChunk_embeddable_com_remarkable_ui||[]).push([[719],{"./src/remarkable-ui/components/charts/tables/HeatMap/HeatMap.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,Resize:()=>Resize,__namedExportsOrder:()=>__namedExportsOrder,default:()=>HeatMap_stories});var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/react/index.js"),tables_module=__webpack_require__("./src/remarkable-ui/components/charts/tables/tables.module.css"),clsx=__webpack_require__("./node_modules/clsx/dist/clsx.mjs");const clamp01=x=>x<0?0:x>1?1:x,easeOutQuad=x=>1-(1-x)*(1-x),lerp=(a,b,t)=>a+(b-a)*t,idOf=v=>String(v??""),CSS_RGB_REGEX=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i,COLOR_CACHE=new Map,normalizeHex=hex=>{if(!hex||"#"!==hex[0])return hex;const v=hex.slice(1).toLowerCase();return 3===v.length?`#${v[0]}${v[0]}${v[1]}${v[1]}${v[2]}${v[2]}`:6===v.length?`#${v}`:hex.toLowerCase()},hexToRgb=color=>{const hex=normalizeHex((input=>{if(!input)return input;const cached=COLOR_CACHE.get(input);if(cached)return cached;if(input.startsWith("#")){const hex=normalizeHex(input);return COLOR_CACHE.set(input,hex),hex}if("undefined"==typeof document)return input;const el=document.createElement("span");el.style.color=input,document.body.appendChild(el);const computed=getComputedStyle(el).color||"";el.remove();const m=computed.match(CSS_RGB_REGEX);if(!m)return input;const[,r="0",g="0",b="0"]=m,toHex=n=>Number(n).toString(16).padStart(2,"0"),hex=`#${toHex(r)}${toHex(g)}${toHex(b)}`.toLowerCase();return COLOR_CACHE.set(input,hex),hex})(color)).slice(1);if(6!==hex.length)return{r:0,g:0,b:0};const i=parseInt(hex,16);return{r:i>>16&255,g:i>>8&255,b:255&i}},lerpColor=(a,b,t)=>{const A=hexToRgb(a),B=hexToRgb(b);return((r,g,b)=>{const to=x=>Math.round(x).toString(16).padStart(2,"0");return`#${to(r)}${to(g)}${to(b)}`})(lerp(A.r,B.r,t),lerp(A.g,B.g,t),lerp(A.b,B.b,t))},getCellColor=backgroundColor=>(color=>{const{r,g,b}=hexToRgb(color);return(299*r+587*g+114*b)/1e3})(backgroundColor)<150?"#FFFFFF":"#212129",thresholdToRaw=(t,rawMin,rawMax,fallback)=>{if(null==t)return fallback;if("number"==typeof t&&Number.isFinite(t))return t;const asPct="string"==typeof t?(s=>{const t=s.trim();if(!t.endsWith("%"))return null;const n=Number.parseFloat(t.slice(0,-1));return Number.isFinite(n)?clamp01(n/100):null})(t):null;if(null!=asPct)return rawMin+asPct*(rawMax-rawMin);const maybe=Number(t);return Number.isFinite(maybe)?maybe:fallback},getCellValue=(value,displayNullAs)=>{const fallback=displayNullAs&&Number.isFinite(Number(displayNullAs))?Number(displayNullAs):displayNullAs;return(v=>{if(null==v)return v;const n=Number(v);return Number.isFinite(n)?n:v})(value??fallback)},getCellDisplayValue=(value,showValues,measure)=>showValues?"string"==typeof value||null==value||Number.isNaN(value)?value:measure?.format?measure.format(Number(value)):value:null,createColorForValue=({domainMin,domainMax,rawMin,rawMax,minColor,midColor,maxColor})=>{const midPoint=((domainMin,domainMax)=>{const range=domainMax-domainMin;return 0===range?.5:((domainMin+domainMax)/2-domainMin)/range})(domainMin,domainMax),scale=((minC,midC,maxC,midpoint=.5)=>{const m=clamp01(midpoint);return t=>{const x=clamp01(t);return x<=m?lerpColor(minC,midC,0===m?1:x/m):lerpColor(midC,maxC,(x-m)/(1-m))}})(minColor,midColor,maxColor,midPoint),leftTailLen=Math.max(1e-6,domainMin-rawMin),rightTailLen=Math.max(1e-6,rawMax-domainMax),domRange=domainMax-domainMin;if(0===domRange){const mid=scale(.5);return _v=>mid}return v=>{if(!Number.isFinite(v))return scale(.5);const t=(v-domainMin)/domRange;if(t<=0){const dist=Math.max(0,domainMin-v)/leftTailLen,strength=.35*easeOutQuad(clamp01(dist));return strength>0?lerpColor(minColor,"#FFFFFF",strength):minColor}if(t>=1){const dist=Math.max(0,v-domainMax)/rightTailLen,strength=.35*easeOutQuad(clamp01(dist));return strength>0?lerpColor(maxColor,"#000000",strength):maxColor}return scale(t)}};var tables_utils=__webpack_require__("./src/remarkable-ui/components/charts/tables/tables.utils.ts"),styles_utils=__webpack_require__("./src/remarkable-ui/styles/styles.utils.ts");const HeatMap=({data,showValues=!1,className,columnDimension,rowDimension,measure,minThreshold,maxThreshold,minColor,midColor=(0,styles_utils.g)("--em-tablechart-heatmap-color","#FF5400"),maxColor,columnWidth,firstColumnWidth,displayNullAs})=>{const{rawMin,rawMax}=(0,react.useMemo)(()=>{let min=1/0,max=-1/0;for(const d of data){const value=getCellValue(d[measure.key],displayNullAs);null!=value&&"number"==typeof value&&Number.isFinite(value)&&(value<min&&(min=value),value>max&&(max=value))}return Number.isFinite(min)&&Number.isFinite(max)?{rawMin:min,rawMax:max}:{rawMin:0,rawMax:0}},[data,measure.key,displayNullAs]),{domainMin,domainMax}=(0,react.useMemo)(()=>{const domMin=thresholdToRaw(minThreshold,rawMin,rawMax,rawMin),domMax=thresholdToRaw(maxThreshold,rawMin,rawMax,rawMax);return domMin<=domMax?{domainMin:domMin,domainMax:domMax}:{domainMin:domMax,domainMax:domMin}},[minThreshold,maxThreshold,rawMin,rawMax]),columnValues=(0,react.useMemo)(()=>Array.from(new Set(data.map(d=>d[columnDimension.key]).filter(v=>null!=v).map(idOf))),[data,columnDimension.key]),rowValues=(0,react.useMemo)(()=>Array.from(new Set(data.map(d=>d[rowDimension.key]).filter(v=>null!=v).map(idOf))),[data,rowDimension.key]),cellMap=(0,react.useMemo)(()=>{const map=new Map;for(const d of data){const r=idOf(d[rowDimension.key]),c=idOf(d[columnDimension.key]);map.has(r)||map.set(r,new Map),map.get(r).set(c,d)}return map},[data,rowDimension.key,columnDimension.key]),colorForValue=(0,react.useCallback)(v=>createColorForValue({domainMin,domainMax,rawMin,rawMax,minColor,midColor,maxColor})(v),[domainMin,domainMax,rawMin,rawMax,minColor,midColor,maxColor]);return(0,jsx_runtime.jsx)("div",{className:(0,clsx.A)(tables_module.A.tableFullContainer,className),children:(0,jsx_runtime.jsx)("div",{className:(0,clsx.A)(tables_module.A.tableAdjustedContainer,(!columnWidth||!firstColumnWidth)&&tables_module.A.fullWidth),children:(0,jsx_runtime.jsxs)("table",{className:tables_module.A.table,"aria-label":"Heat map",children:[(0,jsx_runtime.jsx)("thead",{children:(0,jsx_runtime.jsxs)("tr",{children:[(0,jsx_runtime.jsx)("th",{className:tables_module.A.stickyFirstColumn,style:(0,tables_utils.I)(firstColumnWidth),children:measure.label}),columnValues.map((cv,index)=>(0,jsx_runtime.jsx)("th",{style:(0,tables_utils.I)(columnWidth),children:columnDimension.format?columnDimension.format(cv):cv},`col-${cv}-${index}`))]})}),(0,jsx_runtime.jsx)("tbody",{children:rowValues.map(rv=>(0,jsx_runtime.jsxs)("tr",{children:[(0,jsx_runtime.jsx)("th",{scope:"row",className:tables_module.A.stickyFirstColumn,style:(0,tables_utils.I)(firstColumnWidth),children:rowDimension.format?rowDimension.format(rv):rv}),columnValues.map(cv=>{const obj=cellMap.get(rv)?.get(cv),value=getCellValue(obj?.[measure.key],displayNullAs),background=((value,colorForValue)=>"number"==typeof value&&Number.isFinite(value)?colorForValue(value):"white")(value,colorForValue),color=getCellColor(background);return(0,jsx_runtime.jsx)("td",{style:{background,color,textAlign:"center",...(0,tables_utils.I)(columnWidth)},children:getCellDisplayValue(value,showValues,measure)},`cell-${rv}-${cv}`)})]},`row-${rv}`))})]})})})};HeatMap.__docgenInfo={description:"",methods:[],displayName:"HeatMap",props:{data:{required:!0,tsType:{name:"Array",elements:[{name:"T"}],raw:"T[]"},description:""},measure:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n  key: Extract<keyof T, string>;\n  label: string;\n  format?: (value: number) => string;\n}",signature:{properties:[{key:"key",value:{name:"Extract",elements:[{name:"T"},{name:"string"}],raw:"Extract<keyof T, string>",required:!0}},{key:"label",value:{name:"string",required:!0}},{key:"format",value:{name:"signature",type:"function",raw:"(value: number) => string",signature:{arguments:[{type:{name:"number"},name:"value"}],return:{name:"string"}},required:!1}}]}},description:""},rowDimension:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n  key: Extract<keyof T, string>;\n  label: string;\n  format?: (value: string) => string;\n}",signature:{properties:[{key:"key",value:{name:"Extract",elements:[{name:"T"},{name:"string"}],raw:"Extract<keyof T, string>",required:!0}},{key:"label",value:{name:"string",required:!0}},{key:"format",value:{name:"signature",type:"function",raw:"(value: string) => string",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"string"}},required:!1}}]}},description:""},columnDimension:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n  key: Extract<keyof T, string>;\n  label: string;\n  format?: (value: string) => string;\n}",signature:{properties:[{key:"key",value:{name:"Extract",elements:[{name:"T"},{name:"string"}],raw:"Extract<keyof T, string>",required:!0}},{key:"label",value:{name:"string",required:!0}},{key:"format",value:{name:"signature",type:"function",raw:"(value: string) => string",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"string"}},required:!1}}]}},description:""},showValues:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:""},displayNullAs:{required:!1,tsType:{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]},description:""},minThreshold:{required:!1,tsType:{name:"union",raw:"string | number | `${number}%` | undefined",elements:[{name:"string"},{name:"number"},{name:"literal",value:"`${number}%`"},{name:"undefined"}]},description:'Color thresholds — number = raw value, "NN%" = percentage of [min..max].'},maxThreshold:{required:!1,tsType:{name:"union",raw:"string | number | `${number}%` | undefined",elements:[{name:"string"},{name:"number"},{name:"literal",value:"`${number}%`"},{name:"undefined"}]},description:""},minColor:{required:!0,tsType:{name:"string"},description:""},midColor:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"getStyle('--em-tablechart-heatmap-color', '#FF5400')",computed:!0}},maxColor:{required:!0,tsType:{name:"string"},description:""},columnWidth:{required:!1,tsType:{name:"number"},description:""},firstColumnWidth:{required:!1,tsType:{name:"number"},description:""},missingCellColor:{required:!1,tsType:{name:"string"},description:""}}};const HeatMap_stories={title:"Charts/✅ HeatMap",component:HeatMap,args:{data:[{country:"Australia",month:"Jul 25",orders:4},{country:"Belgium",month:"Jul 25",orders:35},{country:"Canada",month:"Jul 25",orders:3},{country:"Germany",month:"Jul 25",orders:null},{country:"Iceland",month:"Jul 25",orders:null},{country:"New Zealand",month:"Jul 25",orders:80},{country:"United Kingdom",month:"Jul 25",orders:40},{country:"United States",month:"Jul 25",orders:30},{country:"Australia",month:"Aug 25",orders:null},{country:"Belgium",month:"Aug 25",orders:-20},{country:"Canada",month:"Aug 25",orders:100},{country:"Germany",month:"Aug 25",orders:50},{country:"Iceland",month:"Aug 25",orders:null},{country:"New Zealand",month:"Aug 25",orders:4},{country:"United Kingdom",month:"Aug 25",orders:12},{country:"United States",month:"Aug 25",orders:112}],columnDimension:{key:"country",label:"Country"},rowDimension:{key:"month",label:"Month"},measure:{key:"orders",label:"Orders"},maxColor:"white",midColor:"yellow",minColor:"orange",showValues:!0,minThreshold:void 0,maxThreshold:void 0}},Default={},Resize={render:args=>(0,jsx_runtime.jsx)("div",{style:{width:"400px",height:"200px",resize:"both",overflow:"auto"},children:(0,jsx_runtime.jsx)(HeatMap,{...args})})},__namedExportsOrder=["Default","Resize"]},"./src/remarkable-ui/styles/styles.utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>getStyleNumber,g:()=>getStyle});const numericRegex=/^-?\d+(\.\d+)?$/,getStyleValue=variableName=>{if("undefined"==typeof window||"undefined"==typeof document)return"";return getComputedStyle(document.documentElement).getPropertyValue(variableName).trim()},getStyle=(variableName,fallbackValue)=>{const rawValue=getStyleValue(variableName);if(!rawValue)return fallbackValue??rawValue;return"#"===rawValue.charAt(0)||rawValue.startsWith("rgb(")||rawValue.startsWith("rgba("),rawValue},getStyleNumber=(variableName,fallbackValue)=>{const rawValue=getStyleValue(variableName)||fallbackValue;if(!rawValue)return;const numericValue=parseFloat(rawValue),rootFontSize=parseFloat(getComputedStyle(document.documentElement).fontSize);if("px"===rawValue.slice(-2))return numericValue;return"rem"===rawValue.slice(-3)?numericValue*rootFontSize:numericRegex.test(rawValue)?numericValue:void 0}}}]);